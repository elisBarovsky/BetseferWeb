$(document).ready(function () {
    var examDetails = JSON.parse(localStorage.getItem("examDetails"));
    GetAllGradesToSpecificTest(examDetails.examCode, ShowTestGrades);

    //objTest.TeacherID = localStorage.getItem("UserID");
    //objTest.CodeLesson = res[i].subjectCode;
    //objTest.ExamDate = res[i].date;
    //objTest.ClassId = res[i].classID;
});

function ShowTestGrades(results) {
    res = $.parseJSON(results.d);
    var examDetails = JSON.parse(localStorage.getItem("examDetails"));

    document.getElementById('examTitle').innerHTML = "מבחן ב" + examDetails.subject + ", " + examDetails.date + ", כיתה " + examDetails.className +"";
    var str = '<tr><th>ת.ז.</th><th>שם</th><th>ציון</th></tr>';

    for (var i = 0; i < res.length; i++) {
        str += '<tr>' +
            '<td>' + res[i].pupilID + '</td>' +
            '<td>' + res[i].pupilName + '</td>' +
            '<td>' + res[i].grade + '</td>' +
            '</tr>';
    }
    $('#gradesTable').append(str);
};

function SubmitMessage() {
        subject = $('#newSubject').val(),
        content = $('#newMessage').val();

    if (subject === "נושא" || subject === null) {
        subject = "";
    }

    if (content === null) {
        content === "";
    }
    
    if ((subject === "" || subject === "נושא") && content === "") {
        return;
    }

        var message = new Object();

        message.MessageType = "private";
        message.SenderID = localStorage.getItem("UserID");
        message.Subject = subject;
        message.Content = content;
        message.RecipientID = localStorage.getItem("SenderID"); // the one you answer him.

        localStorage.setItem("putMessageUp", JSON.stringify(message));

        SubmitMessageAjax(message, AfterMessageSent);

};

function AfterMessageSent(results) {

    var date = new Date();
    var FullDAte = ('0' + date.getDate()).slice(-2) + "/" + ('0' + (date.getMonth() + 1)).slice(-2) + "/" + date.getFullYear() + " " + ('0' + date.getHours()).slice(-2) + ":" + ('0' + date.getMinutes()).slice(-2) + ":" + ('0' + date.getSeconds()).slice(-2);

    var myImg =localStorage.getItem("UserImg").toString();
    var message = JSON.parse(localStorage.getItem("putMessageUp"));
    var myFullName = localStorage.getItem("UserFullName").toString();

    var messageContent = message.Content.replace(/\n/g, "<br>");

    var str = '<div class="direct-chat-msg">' +
        '<div class="direct-chat-info clearfix">' +
        '<span class="direct-chat-name pull-left">' + myFullName + '</span>' +
        '<span class="direct-chat-timestamp pull-right">' + FullDAte  + '</span>' +
        '</div >' +
        '<img class="direct-chat-img" alt="user image" src="' + myImg + '">' +
        '<div class="direct-chat-text">' +
        '<div><u>' + message.Subject + '</u></div>' +
        messageContent + '</div > ' +
        '</div > ';
   
    document.getElementById('addToHereNewMessage').innerHTML += str;
  
    subject = document.getElementById('newSubject').value="";
    content = document.getElementById('newMessage').value="";
};

